@using CareerPilotAi.Models.JobApplication
@model PersonalInformationViewModel

@{
    ViewData["Title"] = "Personal Information Details";
}

<div class="container-fluid">
    <h1>Enter Your Personal Information</h1>
    <p class="text-muted">Fill out your resume information. All sections marked with * are required.</p>

    <!-- PDF Upload Section - Moved to Top -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="mb-0"><i class="fas fa-magic"></i> Quick Fill from Resume</h3>
        </div>
        <div class="card-body">
            <p class="text-muted">Upload your existing resume in PDF format to automatically populate the form sections below. This will save you time filling out the details manually.</p>
            
            <form id="pdfUploadForm" enctype="multipart/form-data">
                @Html.AntiForgeryToken()
                
                <div class="row align-items-end">
                    <div class="col-lg-8">
                        <label for="pdfFile" class="form-label">Select PDF Resume</label>
                        <input id="pdfFile" name="file" type="file" class="form-control" accept=".pdf" />
                        <div class="form-text">Only PDF files up to 5MB are supported.</div>
                        <span id="pdfFileValidation" class="text-danger"></span>
                    </div>
                    <div class="col-lg-4">
                        <button type="submit" id="processPdfBtn" class="btn btn-primary w-100">
                            <i class="fas fa-file-pdf me-2"></i>Extract Information
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- Loading indicator -->
            <div id="loadingIndicator" class="text-center my-3" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Processing PDF and extracting information...</p>
            </div>
            
            <!-- Status messages -->
            <div id="pdfStatusContainer" class="mt-3"></div>
        </div>
    </div>

    <form asp-action="ProcessPersonalInformation" asp-controller="JobApplication" method="post" id="personalInfoForm">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
        
        <input asp-for="JobApplicationId" type="hidden" />

        <!-- Required Sections First -->
        <div class="alert alert-info mb-4">
            <h5 class="mb-2"><i class="fas fa-info-circle"></i> Required Information</h5>
            <p class="mb-0">Please complete all required sections marked with <strong>*</strong> before proceeding, or use the PDF upload above to auto-fill the form.</p>
        </div>

        <!-- Personal Information Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0">Personal Information *</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="PersonalInformation.Fullname" class="form-label">Full Name *</label>
                            <input asp-for="PersonalInformation.Fullname" class="form-control" />
                            <span asp-validation-for="PersonalInformation.Fullname" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="PersonalInformation.Email" class="form-label">Email Address *</label>
                            <input asp-for="PersonalInformation.Email" class="form-control" type="email" />
                            <span asp-validation-for="PersonalInformation.Email" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="PersonalInformation.Phone" class="form-label">Phone Number</label>
                            <input asp-for="PersonalInformation.Phone" class="form-control" type="tel" />
                            <span asp-validation-for="PersonalInformation.Phone" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="PersonalInformation.Location" class="form-label">Location</label>
                            <input asp-for="PersonalInformation.Location" class="form-control" />
                            <span asp-validation-for="PersonalInformation.Location" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- Links Section -->
                <div class="form-group mb-3">
                    <label class="form-label">Professional Links</label>
                    <div id="linksContainer">
                        <!-- Links will be dynamically added here -->
                    </div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addLink()" id="addLinkBtn">
                        <i class="fas fa-plus"></i> Add Link
                    </button>
                    <small class="form-text text-muted">You can add up to 5 professional links (LinkedIn, GitHub, Portfolio, etc.)</small>
                </div>
            </div>
        </div>

        <!-- Required Sections in Two Columns -->
        <div class="row">
            <!-- Skills Section -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="mb-0">Skills *</h3>
                    </div>
                    <div class="card-body">
                        <div id="skillsContainer">
                            <!-- Skills will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addSkill()" id="addSkillBtn">
                            <i class="fas fa-plus"></i> Add Skill
                        </button>
                        <small class="form-text text-muted">You can add up to 30 skills. <strong>At least 3 skills are required.</strong></small>
                        <div id="skillsValidationMessage" class="text-danger mt-2" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Education Section -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="mb-0">Education *</h3>
                    </div>
                    <div class="card-body">
                        <div id="educationContainer">
                            <!-- Education will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addEducation()">
                            <i class="fas fa-plus"></i> Add Education
                        </button>
                        <small class="form-text text-muted"><strong>At least one education entry is required.</strong></small>
                        <div id="educationValidationMessage" class="text-danger mt-2" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Optional Sections -->
        <div class="alert alert-secondary mb-4">
            <h5 class="mb-2"><i class="fas fa-plus-circle"></i> Optional Information</h5>
            <p class="mb-0">Add additional information to enhance your resume. These sections are optional but recommended.</p>
        </div>

        <!-- Summary Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0">Professional Summary</h3>
            </div>
            <div class="card-body">
                <div class="form-group mb-3">
                    <label asp-for="Summary" class="form-label">Summary</label>
                    <textarea asp-for="Summary" class="form-control" rows="6" id="summaryText" placeholder="Write a brief professional summary..."></textarea>
                    <span asp-validation-for="Summary" class="text-danger"></span>
                    <div class="mt-1">
                        <small class="text-muted">Word count: <span id="summaryWordCount">0</span> / 1,000</small>
                    </div>
                    <div id="summaryWordLimitError" class="text-danger mt-1" style="display: none;">
                        Summary exceeds the maximum limit of 1,000 words. Please shorten your text to continue.
                    </div>
                </div>
            </div>
        </div>

        <!-- Experience and Projects in Two Columns -->
        <div class="row">
            <!-- Work Experience Section -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="mb-0">Work Experience</h3>
                    </div>
                    <div class="card-body">
                        <div id="experienceContainer">
                            <!-- Experience will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addExperience()">
                            <i class="fas fa-plus"></i> Add Work Experience
                        </button>
                    </div>
                </div>
            </div>

            <!-- Projects Section -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="mb-0">Projects</h3>
                    </div>
                    <div class="card-body">
                        <div id="projectsContainer">
                            <!-- Projects will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addProject()">
                            <i class="fas fa-plus"></i> Add Project
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Certifications and Languages in Two Columns -->
        <div class="row">
            <!-- Certifications Section -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="mb-0">Certifications</h3>
                    </div>
                    <div class="card-body">
                        <div id="certificationsContainer">
                            <!-- Certifications will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addCertification()">
                            <i class="fas fa-plus"></i> Add Certification
                        </button>
                    </div>
                </div>
            </div>

            <!-- Languages Section -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="mb-0">Languages</h3>
                    </div>
                    <div class="card-body">
                        <div id="languagesContainer">
                            <!-- Languages will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addLanguage()">
                            <i class="fas fa-plus"></i> Add Language
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Other Information Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0">Additional Information</h3>
            </div>
            <div class="card-body">
                <div id="otherInfoContainer">
                    <!-- Other information will be dynamically added here -->
                </div>
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addOtherInformation()">
                    <i class="fas fa-plus"></i> Add Additional Information
                </button>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="row">
            <div class="col-12">
                <button type="submit" class="btn btn-primary btn-lg" id="submitButton">
                    Continue to Next Step
                </button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/js/word-counter.js"></script>
    <script src="~/js/personal-information-form.js"></script>
    <script src="~/js/custom-validation.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize word counter for summary
            const summaryWordCounter = new WordCounter({
                textAreaSelector: '#summaryText',
                wordCountSelector: '#summaryWordCount',
                maxWords: 1000,
                warningThreshold: 900,
                submitButtonSelector: '#submitButton',
                errorMessageSelector: '#summaryWordLimitError'
            });
            
            // Initialize the personal information form
            PersonalInfoForm.init();
            
            // Run initial validation to show correct state
            setTimeout(() => {
                PersonalInfoForm.validateSkillsRealTime();
                PersonalInfoForm.validateEducationRealTime();
            }, 200);
            
            // PDF Upload functionality
            initializePdfUpload();
            
            // Form submission validation - only validate on actual form submission
            $('#personalInfoForm').on('submit', function(e) {
                // Only validate if this is the main form submission (not PDF upload)
                if ($(e.target).attr('id') !== 'personalInfoForm') {
                    return true;
                }
                
                // Validate word count
                const summaryValidation = summaryWordCounter.validateWordCount();
                
                // Validate required fields and limits
                const formValidation = PersonalInfoForm.validateForm();
                
                if (!summaryValidation.isValid || !formValidation.isValid) {
                    e.preventDefault();
                    
                    if (!formValidation.isValid) {
                        alert(formValidation.message);
                    }
                    
                    return false;
                }
            });
        });

        // PDF Upload initialization
        function initializePdfUpload() {
            const pdfForm = document.getElementById('pdfUploadForm');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const processPdfBtn = document.getElementById('processPdfBtn');
            const statusContainer = document.getElementById('pdfStatusContainer');
            
            pdfForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const pdfFileInput = document.getElementById('pdfFile');
                const pdfFileValidation = document.getElementById('pdfFileValidation');
                
                // Validate file selected
                if (!pdfFileInput.files || pdfFileInput.files.length === 0) {
                    pdfFileValidation.textContent = 'Please select a PDF file to upload';
                    return;
                }
                
                // Clear previous validation message
                pdfFileValidation.textContent = '';
                
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                processPdfBtn.disabled = true;
                statusContainer.innerHTML = '';
                
                // Create form data
                const formData = new FormData();
                formData.append('file', pdfFileInput.files[0]);
                
                // Get anti-forgery token
                const token = pdfForm.querySelector('input[name="__RequestVerificationToken"]').value;
                formData.append('__RequestVerificationToken', token);
                
                try {
                    // Create AbortController for timeout
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 60000); // 60 seconds timeout
                    
                    // Send fetch request
                    const response = await fetch('@Url.Action("ProcessPdf", "JobApplication")', {
                        method: 'POST',
                        body: formData,
                        signal: controller.signal
                    });
                    
                    // Clear timeout as request completed
                    clearTimeout(timeoutId);
                    
                    // Process the response
                    if (response.ok) {
                        const jsonData = await response.json();
                        
                        // Populate form with extracted data
                        populateFormFromJson(jsonData);
                        
                        // Show success message
                        showPdfStatusMessage('success', 'PDF processed successfully. Form sections have been populated with extracted information.');
                    } else {
                        // Handle HTTP error status
                        let errorMessage = 'An error occurred while processing the PDF. Please try again or fill the form manually.';
                        
                        if (response.status === 400) {
                            const messageFromRequest = await response.text();
                            if (messageFromRequest) {
                                errorMessage = messageFromRequest;
                            }
                        }
                        
                        showPdfStatusMessage('error', errorMessage);
                    }
                } catch (error) {
                    console.error(error);
                    // Handle different error types
                    if (error.name === 'AbortError') {
                        showPdfStatusMessage('error', 'The request took too long to complete. Please try again or fill the form manually.');
                    } else {
                        showPdfStatusMessage('error', 'Error processing PDF: ' + error.message);
                    }
                } finally {
                    // Hide loading indicator and re-enable button
                    loadingIndicator.style.display = 'none';
                    processPdfBtn.disabled = false;
                }
            });
        }

        // Helper function to display PDF status messages
        function showPdfStatusMessage(type, message) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const statusContainer = document.getElementById('pdfStatusContainer');
            
            statusContainer.innerHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            
            // Scroll to the message
            statusContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Function to populate form from JSON data
        function populateFormFromJson(data) {
            // Extract content from the response structure
            const content = data.content || data;
            
            // Populate Personal Information
            if (content.personalInformation) {
                const pi = content.personalInformation;
                if (pi.fullname) $('#PersonalInformation_Fullname').val(pi.fullname);
                if (pi.email) $('#PersonalInformation_Email').val(pi.email);
                if (pi.phone) $('#PersonalInformation_Phone').val(pi.phone);
                if (pi.location) $('#PersonalInformation_Location').val(pi.location);
                
                // Populate Links
                if (pi.links && Array.isArray(pi.links)) {
                    // Clear existing links first
                    $('#linksContainer').empty();
                    PersonalInfoForm.counters.links = 0;
                    pi.links.forEach(link => {
                        if (link.label && link.url) {
                            addLink();
                            const index = PersonalInfoForm.counters.links - 1;
                            $(`input[name="PersonalInformation.Links[${index}].Label"]`).val(link.label);
                            $(`input[name="PersonalInformation.Links[${index}].Url"]`).val(link.url);
                        }
                    });
                }
            }
            
            // Populate Summary
            if (content.summary) {
                $('#summaryText').val(content.summary);
                // Trigger word count update
                if (typeof summaryWordCounter !== 'undefined') {
                    summaryWordCounter.validateWordCount();
                }
            }
            
            // Populate Skills
            if (content.skills && Array.isArray(content.skills)) {
                $('#skillsContainer').empty();
                PersonalInfoForm.counters.skills = 0;
                content.skills.forEach(skill => {
                    if (skill.label) {
                        addSkill();
                        const index = PersonalInfoForm.counters.skills - 1;
                        $(`input[name="Skills[${index}].Label"]`).val(skill.label);
                        const allowedLevels = ['n/a', 'Junior', 'Regular', 'Expert'];
                        if (skill.level && allowedLevels.includes(skill.level)) {
                            $(`select[name="Skills[${index}].Level"]`).val(skill.level);
                        } else {
                            $(`select[name="Skills[${index}].Level"]`).val('n/a');
                        }
                    }
                });
                PersonalInfoForm.validateSkillsRealTime();
            }
            
            // Populate Experience
            if (content.experience && Array.isArray(content.experience)) {
                $('#experienceContainer').empty();
                PersonalInfoForm.counters.experience = 0;
                content.experience.forEach(exp => {
                    if (exp.title && exp.company) {
                        addExperience();
                        const index = PersonalInfoForm.counters.experience - 1;
                        $(`input[name="Experience[${index}].Title"]`).val(exp.title);
                        $(`input[name="Experience[${index}].Company"]`).val(exp.company);
                        if (exp.location) $(`input[name="Experience[${index}].Location"]`).val(exp.location);
                        
                        // Handle dates
                        if (exp.startDate) {
                            const startDate = parseDate(exp.startDate);
                            if (startDate) $(`input[name="Experience[${index}].StartDate"]`).val(startDate);
                        }
                        if (exp.endDate && !exp.present) {
                            const endDate = parseDate(exp.endDate);
                            if (endDate) $(`input[name="Experience[${index}].EndDate"]`).val(endDate);
                        }
                        if (exp.present) {
                            $(`input[name="Experience[${index}].Present"]`).prop('checked', true);
                            $(`input[name="Experience[${index}].EndDate"]`).prop('disabled', true);
                        }
                        
                        // Add content points
                        if (exp.listOfContentPoints && Array.isArray(exp.listOfContentPoints)) {
                            const container = $(`#experienceContainer .dynamic-item[data-index="${index}"] .content-points-container`);
                            exp.listOfContentPoints.forEach(point => {
                                PersonalInfoForm.addContentPoint(container);
                                const pointIndex = container.find('.content-point-item').length - 1;
                                container.find(`.content-point-item:eq(${pointIndex}) input`).val(point);
                            });
                        }
                    }
                });
            }
            
            // Populate Education
            if (content.education && Array.isArray(content.education)) {
                $('#educationContainer').empty();
                PersonalInfoForm.counters.education = 0;
                content.education.forEach(edu => {
                    if (edu.degree && edu.institution) {
                        addEducation();
                        const index = PersonalInfoForm.counters.education - 1;
                        $(`input[name="Education[${index}].Degree"]`).val(edu.degree);
                        $(`input[name="Education[${index}].Institution"]`).val(edu.institution);
                        if (edu.location) $(`input[name="Education[${index}].Location"]`).val(edu.location);
                        
                        // Handle dates
                        if (edu.startDate) {
                            const startDate = parseDate(edu.startDate);
                            if (startDate) $(`input[name="Education[${index}].StartDate"]`).val(startDate);
                        }
                        if (edu.endDate && !edu.present) {
                            const endDate = parseDate(edu.endDate);
                            if (endDate) $(`input[name="Education[${index}].EndDate"]`).val(endDate);
                        }
                        if (edu.present) {
                            $(`input[name="Education[${index}].Present"]`).prop('checked', true);
                            $(`input[name="Education[${index}].EndDate"]`).prop('disabled', true);
                        }
                    }
                });
                PersonalInfoForm.validateEducationRealTime();
            }
            
            // Populate Projects
            if (content.projects && Array.isArray(content.projects)) {
                $('#projectsContainer').empty();
                PersonalInfoForm.counters.projects = 0;
                content.projects.forEach(project => {
                    if (project.title) {
                        addProject();
                        const index = PersonalInfoForm.counters.projects - 1;
                        $(`input[name="Projects[${index}].Title"]`).val(project.title);
                        if (project.link) $(`input[name="Projects[${index}].Link"]`).val(project.link);
                        
                        // Add content points
                        if (project.listOfContentPoints && Array.isArray(project.listOfContentPoints)) {
                            const container = $(`#projectsContainer .dynamic-item[data-index="${index}"] .content-points-container`);
                            project.listOfContentPoints.forEach(point => {
                                PersonalInfoForm.addContentPoint(container);
                                const pointIndex = container.find('.content-point-item').length - 1;
                                container.find(`.content-point-item:eq(${pointIndex}) input`).val(point);
                            });
                        }
                        
                        // Add technologies
                        if (project.technologies && Array.isArray(project.technologies)) {
                            const container = $(`#projectsContainer .dynamic-item[data-index="${index}"] .technologies-container`);
                            project.technologies.forEach(tech => {
                                PersonalInfoForm.addTechnology(container);
                                const techIndex = container.find('.content-point-item').length - 1;
                                container.find(`.content-point-item:eq(${techIndex}) input`).val(tech);
                            });
                        }
                    }
                });
            }
            
            // Populate Certifications
            if (content.certifications && Array.isArray(content.certifications)) {
                $('#certificationsContainer').empty();
                PersonalInfoForm.counters.certifications = 0;
                content.certifications.forEach(cert => {
                    if (cert.title && cert.issuer) {
                        addCertification();
                        const index = PersonalInfoForm.counters.certifications - 1;
                        $(`input[name="Certifications[${index}].Title"]`).val(cert.title);
                        $(`input[name="Certifications[${index}].Issuer"]`).val(cert.issuer);
                        if (cert.date) {
                            const date = parseDate(cert.date);
                            if (date) $(`input[name="Certifications[${index}].Date"]`).val(date);
                        }
                        if (cert.description) $(`textarea[name="Certifications[${index}].Description"]`).val(cert.description);
                        if (cert.link) $(`input[name="Certifications[${index}].Link"]`).val(cert.link);
                    }
                });
            }
            
            // Populate Languages
            if (content.languages && Array.isArray(content.languages)) {
                $('#languagesContainer').empty();
                PersonalInfoForm.counters.languages = 0;
                content.languages.forEach(lang => {
                    if (lang.Language && lang.proficiency) {
                        addLanguage();
                        const index = PersonalInfoForm.counters.languages - 1;
                        $(`input[name="Languages[${index}].Language"]`).val(lang.Language);
                        $(`select[name="Languages[${index}].Proficiency"]`).val(lang.proficiency);
                    }
                });
            }
            
            // Populate Other Information
            if (content.otherInformation && Array.isArray(content.otherInformation)) {
                $('#otherInfoContainer').empty();
                PersonalInfoForm.counters.otherInfo = 0;
                content.otherInformation.forEach(other => {
                    if (other.label) {
                        addOtherInformation();
                        const index = PersonalInfoForm.counters.otherInfo - 1;
                        $(`input[name="OtherInformation[${index}].Label"]`).val(other.label);
                        if (other.title) $(`input[name="OtherInformation[${index}].Title"]`).val(other.title);
                        
                        // Add content points
                        if (other.listOfContentPoints && Array.isArray(other.listOfContentPoints)) {
                            const container = $(`#otherInfoContainer .dynamic-item[data-index="${index}"] .content-points-container`);
                            other.listOfContentPoints.forEach(point => {
                                PersonalInfoForm.addContentPoint(container);
                                const pointIndex = container.find('.content-point-item').length - 1;
                                container.find(`.content-point-item:eq(${pointIndex}) input`).val(point);
                            });
                        }
                    }
                });
            }
        }
        
        // Helper function to parse date strings
        function parseDate(dateStr) {
            if (!dateStr) return null;
            
            // Handle various date formats
            if (dateStr.includes('Present') || dateStr.toLowerCase().includes('current')) {
                return null;
            }
            
            // Try to parse different formats
            const formats = [
                /^(\d{4})$/, // Just year
                /^(\w{3})\s+(\d{4})$/, // "Jan 2020"
                /^(\w+)\s+(\d{4})$/, // "January 2020"
                /^(\d{1,2})\/(\d{4})$/, // "01/2020"
            ];
            
            for (const format of formats) {
                const match = dateStr.match(format);
                if (match) {
                    if (match.length === 2) {
                        // Just year
                        return `${match[1]}-01-01`;
                    } else if (match.length === 3) {
                        // Month and year
                        const monthMap = {
                            'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04',
                            'May': '05', 'Jun': '06', 'Jul': '07', 'Aug': '08',
                            'Sep': '09', 'Oct': '10', 'Nov': '11', 'Dec': '12',
                            'January': '01', 'February': '02', 'March': '03', 'April': '04',
                            'June': '06', 'July': '07', 'August': '08', 'September': '09',
                            'October': '10', 'November': '11', 'December': '12'
                        };
                        const month = monthMap[match[1]] || '01';
                        return `${match[2]}-${month}-01`;
                    }
                }
            }
            
            return null;
        }
    </script>
    
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<style>
    .dynamic-item {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8f9fa;
        position: relative;
    }

    .remove-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        border: 1px solid #dc3545;
        background-color: #fff;
        color: #dc3545;
        font-size: 12px;
        transition: all 0.2s ease;
    }

    .remove-btn:hover {
        background-color: #dc3545;
        color: #fff;
        transform: scale(1.1);
    }

    .content-point-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .content-point-item input {
        flex: 1;
        margin-right: 0.5rem;
    }

    .content-point-item .remove-content-point,
    .content-point-item .remove-technology {
        position: relative;
        top: auto;
        right: auto;
        width: 24px;
        height: 24px;
        font-size: 10px;
        margin-left: 0.5rem;
    }

    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }

    .card-header h3 {
        color: #495057;
    }

    .form-label {
        font-weight: 500;
        color: #495057;
    }

    .text-muted {
        font-size: 0.875rem;
    }

    /* Education section specific improvements */
    #educationContainer .dynamic-item .form-control {
        min-width: 0; /* Allow inputs to shrink */
        width: 100%; /* Take full available width */
    }

    /* Responsive improvements for education section */
    #educationContainer .dynamic-item .row {
        margin-left: -0.5rem;
        margin-right: -0.5rem;
    }

    #educationContainer .dynamic-item .row > [class*="col-"] {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }

    /* Stack education inputs on smaller screens */
    @@media (max-width: 992px) {
        #educationContainer .dynamic-item .col-lg-6 {
            margin-bottom: 0.75rem;
        }
    }

    /* Improve input sizing for better content visibility */
    #educationContainer .form-control {
        min-height: 40px;
        padding: 0.625rem 0.75rem;
        font-size: 0.95rem;
        line-height: 1.4;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    #educationContainer .form-control:focus {
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    /* Special handling for date inputs */
    #educationContainer input[type="date"] {
        min-width: 140px;
        max-width: 100%;
    }

    /* Ensure long text is visible in inputs */
    #educationContainer input[type="text"] {
        min-width: 0;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
    }

    #educationContainer input[type="text"]:focus {
        white-space: normal;
        overflow: visible;
    }

    /* Current checkbox alignment */
    #educationContainer .form-check {
        display: flex;
        align-items: center;
        min-height: 38px;
        padding-top: 0;
        margin-top: 0;
    }

    #educationContainer .form-check-label {
        margin-left: 0.25rem;
        font-size: 0.875rem;
    }

    /* Ensure icons display properly */
    .fas, .fa {
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
    }
</style> 