@model CareerPilotAi.ViewModels.JobApplication.JobApplicationDetailsViewModel
@using CareerPilotAi.ViewModels.JobApplication
@{
    ViewData["Title"] = Model.JobTitle + " - " + Model.CompanyName;
    
    // Helper function to get CSS class from status
    string GetStatusCssClass(string status)
    {
        var output = $"status-{status?.ToLower()?.Replace(" ", "-")}";
        return output;
    }
    
    // Helper function to get CSS class from skill level
    string GetSkillCssClass(SkillViewModel skill)
    {
        if (string.IsNullOrEmpty(skill?.Level))
            return "skill-badge-regular";

        return skill.Level.Replace(" ", "").ToLower() switch
        {
            "nicetohave" => "skill-badge-nice-to-have",
            "junior" => "skill-badge-junior",
            "regular" => "skill-badge-regular",
            "advanced" => "skill-badge-advanced",
            "master" => "skill-badge-master",
            _ => "skill-badge-regular"
        };
    }
}

<link href="~/css/interview-questions.css" rel="stylesheet" />
<link href="~/css/job-application-details.css" rel="stylesheet" />

@Html.AntiForgeryToken()

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center gap-3">
                    <div>
                        <h2 class="mb-0">@Model.JobTitle</h2>
                        <p class="text-muted mb-0">@Model.CompanyName</p>
                    </div>
                    <!-- Status Dropdown -->
                    <div class="dropdown">
                        <button class="btn dropdown-toggle d-flex align-items-center gap-2" 
                                type="button" 
                                id="statusDropdown" 
                                data-bs-toggle="dropdown" 
                                aria-expanded="false">
                            <span class="status-dot @GetStatusCssClass(Model.Status)"></span>
                            <span class="status-text">@Model.Status</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="statusDropdown">
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="Draft" data-color-class="status-draft">
                                <span class="status-dot status-draft"></span>Draft
                            </a></li>
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="Submitted" data-color-class="status-submitted">
                                <span class="status-dot status-submitted"></span>Submitted
                            </a></li>
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="Interview Scheduled" data-color-class="status-interview-scheduled">
                                <span class="status-dot status-interview-scheduled"></span>Interview Scheduled
                            </a></li>
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="Waiting for offer" data-color-class="status-waiting-for-offer">
                                <span class="status-dot status-waiting-for-offer"></span>Waiting for offer
                            </a></li>
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="Received offer" data-color-class="status-received-offer">
                                <span class="status-dot status-received-offer"></span>Received offer
                            </a></li>
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="Rejected" data-color-class="status-rejected">
                                <span class="status-dot status-rejected"></span>Rejected
                            </a></li>
                            <li><a class="dropdown-item d-flex align-items-center gap-2" href="#" data-status="No contact" data-color-class="status-no-contact">
                                <span class="status-dot status-no-contact"></span>No contact
                            </a></li>
                        </ul>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <a href="/job-applications" class="btn btn-outline-secondary px-4">
                        <i class="fas fa-arrow-left"></i> <span class="ms-2">Back</span>
                    </a>
                    <a href="@Url.Action("Edit", "JobApplication", new { id = Model.JobApplicationId })" class="btn btn-outline-primary">
                        <i class="fas fa-edit me-2"></i>Edit
                    </a>
                    <button type="button" 
                            class="btn btn-outline-danger" 
                            onclick="confirmDelete('@Model.JobApplicationId', '@Model.JobTitle')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <ul class="nav nav-tabs" id="jobApplicationTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="job-details-tab" data-bs-toggle="tab" data-bs-target="#job-details" type="button" role="tab" data-tab-param="job-details">
                        <i class="fas fa-briefcase me-2"></i>Job Details
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="interview-questions-tab" data-bs-toggle="tab" data-bs-target="#interview-questions" type="button" role="tab" data-tab-param="interview-questions">
                        <i class="fas fa-question-circle me-2"></i>Interview Questions
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="jobApplicationTabContent">
                <!-- Job Details Tab -->
                <div class="tab-pane fade show active" id="job-details" role="tabpanel">
                    <div class="row mt-4">
                        <!-- Left Column: Main Content -->
                        <div class="col-lg-8">
                            <!-- Job Description Card -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Job Description & Requirements</h5>
                                    <pre class="job-description-display">@Model.JobDescription</pre>
                                </div>
                            </div>

                            <!-- Skills Card -->
                            @if (Model.Skills != null && Model.Skills.Any())
                            {
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">Required Skills</h5>
                                        <div class="skills-container">
                                            @foreach (var skill in Model.Skills)
                                            {
                                                <span class="badge @GetSkillCssClass(skill) me-2 mb-2 skill-common">
                                                    @skill.Name (@skill.Level)
                                                </span>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="card">
                                    <div class="card-body">
                                        <p class="text-muted mb-0">No skills specified</p>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Right Column: Sidebar Information -->
                        <div class="col-lg-4">
                            <!-- Key Information Card -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Key Information</h5>
                                    <div class="info-item mb-1">
                                        <small class="text-muted d-block">Experience Level</small>
                                        <i class="fas fa-chart-line me-2 text-primary"></i>
                                        <span>@Model.ExperienceLevel</span>
                                    </div>
                                    <div class="info-item mb-1">
                                        <small class="text-muted d-block">Location</small>
                                        <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                                        <span>@Model.Location</span>
                                    </div>
                                    <div class="info-item mb-1">
                                        <small class="text-muted d-block">Work Mode</small>
                                        <i class="fas fa-laptop me-2 text-primary"></i>
                                        <span>@Model.WorkMode</span>
                                    </div>
                                    <div class="info-item">
                                        <small class="text-muted d-block">Contract Type</small>
                                        <i class="fas fa-handshake me-2 text-primary"></i>
                                        <span>@Model.ContractType</span>
                                    </div>
                                </div>
                            </div>
                            <div id="jobApplicationId" style="display: none;">@Model.JobApplicationId</div>

                            <!-- Salary Information Card -->
                            @if (Model.SalaryMin.HasValue)
                            {
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">Salary Information</h5>
                                        <div class="info-item mb-1">
                                            <small class="text-muted d-block">Range</small>
                                            <i class="fas fa-money-bill-wave me-2 text-success"></i>
                                            <span>
                                                @Model.SalaryMin?.ToString("N0") PLN - @Model.SalaryMax?.ToString("N0") PLN
                                            </span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(Model.SalaryType))
                                        {
                                            <div class="info-item mb-1">
                                                <small class="text-muted d-block">Type</small>
                                                <span>@(Model.SalaryType?.ToLowerInvariant() == "gross" ? "Gross" : "Net")</span>
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(Model.SalaryPeriod))
                                        {
                                            <div class="info-item">
                                                <small class="text-muted d-block">Period</small>
                                                <span>@Model.SalaryPeriod</span>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }

                            <!-- Additional Information Card -->
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Additional Information</h5>
                                    @if (!string.IsNullOrEmpty(Model.JobUrl))
                                    {
                                        <div class="info-item mb-1">
                                            <small class="text-muted d-block">Job URL</small>
                                            <a href="@Model.JobUrl" target="_blank" rel="noopener noreferrer" class="text-primary">
                                                <i class="fas fa-external-link-alt me-1"></i>View Offer
                                            </a>
                                        </div>
                                    }
                                    <div class="info-item mb-1">
                                        <small class="text-muted d-block">Created</small>
                                        <i class="fas fa-calendar me-2 text-info"></i>
                                        <span>@Model.CreatedAt.ToString("dd MMMM yyyy, HH:mm")</span>
                                    </div>
                                    <div class="info-item">
                                        <small class="text-muted d-block">Last Updated</small>
                                        <i class="fas fa-calendar me-2 text-info"></i>
                                        <span>@Model.UpdatedAt.ToString("dd MMMM yyyy, HH:mm")</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interview Questions Tab -->
                @await Html.PartialAsync("_InterviewQuestionsTab", Model)
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/interview-questions.js"></script>
    <script src="~/js/job-application-details.js"></script>
}